<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Submission</title>
  </head>
  <body>
    <h2>Submit Form</h2>
    <form
      id="userForm"
      action="/submit"
      method="POST"
      enctype="multipart/form-data"
    >
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required /><br /><br />

      <label for="mobile">Mobile:</label>
      <input type="text" id="mobile" name="mobile" required /><br /><br />

      <label for="referralCode">Referral Code:</label>
      <input type="text" id="referralCode" name="referralCode" /><br /><br />

      <label>Gender:</label>
      <input type="radio" id="male" name="gender" value="Male" required /> Male
      <input type="radio" id="female" name="gender" value="Female" required />
      Female<br /><br />

      <label>Technology:</label>
      <input type="checkbox" name="technology" value="Nodejs" /> Nodejs
      <input type="checkbox" name="technology" value="React" /> React
      <input type="checkbox" name="technology" value="SQL" /> SQL<br /><br />

      <label for="profilePic">Profile Pic:</label>
      <input
        type="file"
        id="profilePic"
        name="profilePic"
        multiple
      /><br /><br />

      <label for="dob">Date of Birth:</label>
      <input type="date" id="dob" name="dob" required /><br /><br />

      <input type="submit" value="Submit" />
    </form>
    <h2>Submitted Data</h2>
    <button onclick="fetchData()">Show Submitted Data</button>
    <table border="1" id="dataTable" style="margin-top: 20px">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Mobile</th>
          <th>Referral Code</th>
          <th>Gender</th>
          <th>Technology</th>
          <th>Profile Pics</th>
          <th>DOB</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      function formatDate(isoDate) {
        const date = new Date(isoDate);
        const day = String(date.getDate()).padStart(2, "0"); // Ensure 2 digits
        const month = String(date.getMonth() + 1).padStart(2, "0"); // Months are 0-indexed
        const year = date.getFullYear();
        return `${day}-${month}-${year}`;
      }
      // Fetch data from the server and display it in the table
      async function fetchData() {
        const response = await fetch("/users");
        const data = await response.json();
        const tableBody = document.querySelector("#dataTable tbody");
        tableBody.innerHTML = ""; // Clear old data

        data.forEach((user) => {
          const profilePicsArray = JSON.parse(user.profilePic);

          const profilePics = profilePicsArray
            .map(
              (pic) =>
                `<img src="http://localhost/project/referralUserSystem/refral/uploads/${pic}" alt="Profile Pic" width="50" height="50" style="margin: 5px;">`
            )
            .join("");
          const formattedDob = formatDate(user.dob);
          const row = `
                  <tr>
                      <td>${user.id}</td>
                      <td>${user.name}</td>
                      <td>${user.mobile}</td>
                      <td>${user.referralCode}</td>
                      <td>${user.gender}</td>
                      <td>${user.technology}</td>
                      <td>${profilePics}</td>
                      <td>${formattedDob}</td>
                  </tr>
              `;
          tableBody.innerHTML += row;
        });
      }
    </script>
  </body>
</html>
